<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="report">
	<!-- 오류 신고하기 1차 입력  -->
	<insert id="firstReportInsert" parameterType="java.util.Map">
		INSERT INTO userReport
			(
				member_seq,
				photo_uciCode,
				reason,
				mailing,
				regDate
			)
		VALUES
			(
				#{writeUserSeq}, 
				#{uciCode},
				#{content},
				#{mailingCheck},
				NOW()
			)
	</insert>
	
	<!-- 오류 신고하기 내용 가져오기(개인 오류 신고 내역, 수정완료 메일에 참조) -->
	<select id="reportSelect" parameterType="java.util.Map" resultType="java.util.HashMap">
		SELECT 
			A.seq,
			A.member_seq,
			B.copyright as media,
			B.compCode,
			A.photo_uciCode as `uciCode`,
			A.reason,
			A.mailing,
			A.status,
			DATE_FORMAT(A.regDate,'%Y-%m-%d') as `regDate`,
			DATE_FORMAT(A.modifyDate,'%Y-%m-%d') as `modifyDae`
		FROM 
			userReport A
		INNER JOIN
			photo B
		on A.photo_uciCode = B.uciCode
		<where>
			1=1
			<if test="seq != null and seq != 0">
			AND	A.seq = #{seq}
			</if>
			<if test="member_seq != null and member_seq != 0">
			AND	A.member_seq = #{member_seq}
			</if>
			<if test="media != null and media != ''" >
			AND	B.copyright = #{media}
			</if>
			<if test="status != null and status != 0" >
			AND	A.status = #{status}
			</if>
		</where>
		<if test="startPage != null">
		LIMIT #{startPage}, #{pageVol}
		</if>
	</select>
	
	<!-- 오류 신고하기 내용 가져오기(개인 오류 신고 내역, 수정완료 메일에 참조) 총 갯수 -->
	<select id="reportSelectTotalCnt" parameterType="java.util.Map" resultType="Integer">
		SELECT 
			COUNT(A.seq) as cnt
		FROM 
			userReport A
		INNER JOIN
			photo B
		on A.photo_uciCode = B.uciCode
		<where>
			1=1
			<if test="seq != null and seq != 0">
			AND	A.seq = #{seq}
			</if>
			<if test="member_seq != null and member_seq != 0">
			AND	A.member_seq = #{member_seq}
			</if>
			<if test="media != null and media != ''">
			AND	B.copyright = #{media}
			</if>
			<if test="status != null and status != 0">
			AND	A.status = #{status}
			</if>
		</where>
	</select>
	
	<!-- 오류 신고하기 수정 완료  -->
	<update id="reportModifyComplete" parameterType="Integer">
		UPDATE userReport 
		SET
			modifyDate = NOW(),
			status = 2
		WHERE
			seq = #{seq}
	</update>
	
	<!-- 오류 신고하기 수정완료 되지 않은 리스트 있는지 확인 status - 0:전체, 1:접수, 2:수정완료 -->
	<select id="reportNotCompleteCnt" parameterType="Integer" resultType="Integer">
		SELECT 
			COUNT(A.seq) as cnt
		FROM 
			userReport A
		INNER JOIN
			photo B
		on A.photo_uciCode = B.uciCode
		<where>
			A.status = 1
			<if test="value != 0">
			AND A.member_seq = #{value}
			</if>
		</where>
	</select>
	
	<!-- 오류 신고하기 접수자 메일 받아오기 -->
	<select id="reportWriterEmail" parameterType="Integer" resultType="String">
		SELECT
			email
		FROM
			member
		WHERE
			seq = #{value}	
	</select>
</mapper>