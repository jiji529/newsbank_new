<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Member">

	<!-- 활성 매체사 리스트 읽기 -->
	<select id="listActiveMedia" resultType="com.dahami.newsbank.web.dto.MemberDTO">
		select * from member
		where type = 'M'
		and activate = 1
		order by name asc
	</select>

	<!-- 로그인 체크 및 비밀번호 찾기 -->
	<select id="selectLogin" parameterType="com.dahami.newsbank.web.dto.MemberDTO"
		resultType="com.dahami.newsbank.web.dto.MemberDTO">
		SELECT
		`seq`, `id`, `pw`, `email`, `name`, `phone`, `type`,
		`permission`,
		`deferred`, `compNum`, `compDocPath`, `compName`,
		`compAddress`,
		`compAddDetail`, `compZipcode`, `compBankName`,
		`compBankAcc`,
		`compBankPath`, `compTel`, `contractPath`,
		DATE_FORMAT(`contractStart`,'%Y-%m-%d') AS `contractStart`,
		DATE_FORMAT(`contractEnd`,'%Y-%m-%d') AS `contractEnd`,
		`contractAuto`, `preRate`, `postRate`,
		`taxName`,
		`taxPhone`,
		`taxEmail`, DATE_FORMAT(`regDate`,'%Y-%m-%d') AS
		`regDate`,
		`logo`,
		`activate`, `master_seq`, `group_seq` FROM member
		where
		1
		<if test="id != null">
			AND id = #{id}
		</if>
		<if test="pw != null">
			AND pw = #{pw}
		</if>
		<if test="name != null">
			AND name = #{name}
		</if>
		<if test="phone != null">
			AND phone = #{phone}
		</if>
		<if test="seq >0">
			AND seq = #{seq}
		</if>

	</select>

	<!-- 회원가입 아이디 체크 -->
	<select id="selectId" parameterType="java.util.Map" resultType="int">
		SELECT count(seq) FROM member
		where id = #{id}


	</select>

	<!-- 회원가입 -->
	<insert id="insertMember" parameterType="com.dahami.newsbank.web.dto.MemberDTO"
		useGeneratedKeys="true" keyProperty="seq">
		INSERT INTO member (
		id, pw, email ,name, phone, type
		<if test="compNum != null">, compNum</if>
		<if test="compDocPath != null">, compDocPath</if>
		<if test="compName != null">, compName</if>
		<if test="compAddress != null">, compAddress</if>
		<if test="compAddDetail != null">, compAddDetail</if>
		<if test="compZipcode != null">, compZipcode</if>
		<if test="compTel != null">, compTel</if>
		<if test="logo != null">, logo</if>
		) values (
		#{id},#{pw},#{email},#{name},#{phone},#{type}
		<if test="compNum != null">, #{compNum}</if>
		<if test="compDocPath != null">, #{compDocPath}</if>
		<if test="compName != null">, #{compName}</if>
		<if test="compAddress != null">, #{compAddress}</if>
		<if test="compAddDetail != null">, #{compAddDetail}</if>
		<if test="compZipcode != null">, #{compZipcode}</if>
		<if test="compTel != null">, #{compTel}</if>
		<if test="logo != null">, #{logo}</if>
		)
		<selectKey resultType="int" keyProperty="seq">
			SELECT
			LAST_INSERT_ID()
		</selectKey>

	</insert>

	<!-- 회원정보 업데이트 -->
	<update id="updateMember" parameterType="com.dahami.newsbank.web.dto.MemberDTO">
		update member
		<set>
			type = #{type}
			<if test="pw != null">, pw = #{pw}</if>
			<if test="email != null">, email = #{email}</if>
			<if test="name != null">, name = #{name}</if>
			<if test="permission != null">, permission = #{permission}</if>
			<if test="deferred != null">, deferred = #{deferred}</if>
			<if test="compNum != null">, compNum = #{compNum}</if>
			<if test="compDocPath != null">, compDocPath = #{compDocPath}</if>
			<if test="compName != null">, compName = #{compName}</if>
			<if test="compAddress != null">, compAddress = #{compAddress}</if>
			<if test="compAddDetail != null">, compAddDetail = #{compAddDetail}</if>
			<if test="compZipcode != null">, compZipcode = #{compZipcode}</if>
			<if test="compBankName != null">, compBankName = #{compBankName}</if>
			<if test="compBankAcc != null">, compBankAcc = #{compBankAcc}</if>
			<if test="compBankPath != null">, compBankPath = #{compBankPath}</if>
			<if test="compTel != null">, compTel = #{compTel}</if>
			<if test="contractPath != null">, contractPath = #{contractPath}</if>
			<if test="contractStart != null">, contractStart = #{contractStart}</if>
			<if test="contractEnd != null">, contractEnd = #{contractEnd}</if>
			<if test="contractAuto != null">, contractAuto = #{contractAuto}</if>
			<if test="preRate != null">, preRate = #{preRate}</if>
			<if test="postRate != null">, postRate = #{postRate}</if>
			<if test="taxName != null">, taxName = #{taxName}</if>
			<if test="taxPhone != null">, taxPhone = #{taxPhone}</if>
			<if test="taxEmail != null">, taxEmail = #{taxEmail}</if>
			<if test="logo != null">, logo = #{logo}</if>
			<if test="activate >0">, activate = #{activate}</if>
			<if test="master_seq >0">, master_seq = #{master_seq}</if>
			<if test="group_seq >0">, group_seq = #{group_seq}</if>
		</set>
		where seq = #{seq}
	</update>


	<!-- 아이디 찾기 -->
	<select id="selectFindId" parameterType="com.dahami.newsbank.web.dto.MemberDTO"
		resultType="com.dahami.newsbank.web.dto.MemberDTO">
		SELECT * FROM member
		WHERE name = #{name}
		AND phone= #{phone}
	</select>


	<select id="listMember" resultType="java.util.HashMap">
		SELECT * FROM member LIMIT
		100

	</select>

	<!-- 활성 매체사 리스트 읽기 -->
	<select id="listAdjustMedia" resultType="com.dahami.newsbank.web.dto.MemberDTO">
		SELECT
		`seq`, `id`, `email`, `name`, `phone`, `type`,
		`permission`,
		`deferred`, `compNum`, `compDocPath`, `compName`,
		`compAddress`,
		`compAddDetail`, `compZipcode`, `compBankName`,
		`compBankAcc`,
		`compBankPath`, `compTel`, `contractPath`,
		DATE_FORMAT(`contractStart`,'%Y-%m-%d') AS `contractStart`,
		DATE_FORMAT(`contractEnd`,'%Y-%m-%d') AS `contractEnd`,
		`contractAuto`, `preRate`, `postRate`,
		`taxName`,
		`taxPhone`, `taxEmail`, DATE_FORMAT(`regDate`,'%Y-%m-%d') AS
		`regDate`,
		`logo`, `activate`, `master_seq`, `group_seq` FROM `member`
		WHERE `type` = 'M'
		AND `activate` = 1
		AND `compName`!=''
		AND `compName`
		is not null
		<if test="seq != 0">
			AND `seq` = #{seq}
			OR `seq` IN (SELECT `adjSlave` FROM
			`adjustment` WHERE `admission`='Y'
			AND `adjMaster` = #{seq})
		</if>
		ORDER BY `compName` ASC
	</select>

</mapper>